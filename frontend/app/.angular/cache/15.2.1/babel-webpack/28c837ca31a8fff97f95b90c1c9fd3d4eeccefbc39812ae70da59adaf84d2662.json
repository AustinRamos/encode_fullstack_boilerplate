{"ast":null,"code":"import _asyncToGenerator from \"/Users/austinramos/Documents/Workspace/Encode_Bootcamp/14_15_code/frontend/app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Contract, ethers } from 'ethers';\n//import * as tokenJson from './assets/MyToken.json';\nimport tokenJson from '../assets/MyToken.json';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/common\";\nfunction AppComponent_div_4_div_5_button_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_4_div_5_button_10_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r9);\n      i0.ɵɵnextContext();\n      const _r4 = i0.ɵɵreference(14);\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r8.requestTokens(_r4.value));\n    });\n    i0.ɵɵtext(1, \" Request Voting Tokens \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_div_4_div_5_button_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_4_div_5_button_15_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      i0.ɵɵnextContext();\n      const _r6 = i0.ɵɵreference(19);\n      const _r7 = i0.ɵɵreference(23);\n      const ctx_r10 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r10.delegateTokens(_r6.value, _r7.value));\n    });\n    i0.ɵɵtext(1, \" Delegate Voting Tokens \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_div_4_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"div\", 12)(2, \"h5\", 13);\n    i0.ɵɵtext(3, \"User Wallet\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"h6\", 14);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 15);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"p\", 15);\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(10, AppComponent_div_4_div_5_button_10_Template, 2, 0, \"button\", 16);\n    i0.ɵɵelementStart(11, \"p\");\n    i0.ɵɵtext(12, \"Amount: \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(13, \"input\", 17, 18);\n    i0.ɵɵtemplate(15, AppComponent_div_4_div_5_button_15_Template, 2, 0, \"button\", 19);\n    i0.ɵɵelementStart(16, \"p\");\n    i0.ɵɵtext(17, \"Amount: \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(18, \"input\", 17, 20);\n    i0.ɵɵelementStart(20, \"p\");\n    i0.ɵɵtext(21, \"Address: \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(22, \"input\", 21, 22);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r4 = i0.ɵɵreference(14);\n    const _r6 = i0.ɵɵreference(19);\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r1.userAddress);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" Balance: \", ctx_r1.userEthBalance, \" Eth\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" Token Balance: \", ctx_r1.userTokenBalance, \" MKT\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", _r4);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", _r6);\n  }\n}\nfunction AppComponent_div_4_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"div\", 12)(2, \"h5\", 13);\n    i0.ɵɵtext(3, \"TokenContract\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"h6\", 14);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 15);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r2.tokenContractAddress);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" Total token Supply: \", ctx_r2.tokenSupply, \" MKT Tokens\");\n  }\n}\nfunction AppComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 7)(1, \"p\", 8);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_4_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.handleAuth());\n    });\n    i0.ɵɵtext(4, \" Connect Wallet \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, AppComponent_div_4_div_5_Template, 24, 5, \"div\", 10);\n    i0.ɵɵtemplate(6, AppComponent_div_4_div_6_Template, 8, 2, \"div\", 10);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" We are connected to Goerli at Block number \", ctx_r0.blockNumber, \". \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.userWallet);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.tokenContractAddress);\n  }\n}\nconst API_URL = \"http://localhost:3000\";\nexport class AppComponent {\n  constructor(http) {\n    this.http = http;\n    this.blockNumber = 0;\n    //this.provider = ethers.getDefaultProvider('goerli');\n    this.provider = new ethers.providers.Web3Provider(window.ethereum);\n    //setInterval(()=>{this.blockNumber +=1 })\n  }\n\n  getTokenAddress() {\n    return this.http.get(API_URL + \"/contract-address\");\n  }\n  getTotalSupply() {\n    return this.http.get(API_URL + \"/total-supply\");\n  }\n  syncBlock() {\n    //this.blockNumber = \"loading...\";\n    this.provider.getBlock(\"latest\").then(block => {\n      this.blockNumber = block.number;\n      this.transactions = block.transactions;\n    });\n    this.getTokenAddress().subscribe(resp => {\n      this.tokenContractAddress = resp.address;\n      this.updateTokenInfo();\n    });\n  }\n  updateTokenInfo() {\n    this.tokenContract = new Contract(this.tokenContractAddress ?? \"\", tokenJson.abi, this.provider);\n    this.tokenContract['totalSupply']().then(resp => {\n      const balanceStr = ethers.utils.formatEther(resp);\n      this.tokenSupply = parseFloat(balanceStr);\n    });\n  }\n  requestTokens(amount) {\n    console.log(\"component requestToken amount: \", amount);\n    const url = API_URL + \"/request-tokens\";\n    const body = {\n      address: this.userAddress,\n      amount: ethers.utils.parseEther(amount)\n    };\n    return this.http.post(url, body).subscribe(res => {\n      console.log(\"requested amount \", amount, \" tokens for address \", this.userAddress);\n      console.log(\"component Request Token: \", res);\n      console.log(\"TX Hash: \", res.result);\n    });\n  }\n  delegateTokens(amount, delegateAddress) {\n    console.log(\"component delegateToken amount: \", amount);\n    this.tokenContract = new Contract(this.tokenContractAddress ?? \"\", tokenJson.abi, this.provider);\n    this.tokenContract['delegate'](ethers.utils.parseEther(amount), delegateAddress).then(resp => {\n      const balanceStr = ethers.utils.formatEther(resp);\n      this.tokenSupply = parseFloat(balanceStr);\n    });\n    // const url = API_URL + \"/delegate-tokens\";\n    // const body = {address:this.userAddress,delegate:delegateAddress,amount: ethers.utils.parseEther(amount)};\n    // return this.http.post<{result: string}>(url, body).subscribe((res)=>{\n    //   console.log(\"Delegated \" , amount , \" tokens from address \" , this.userAddress, \"to address \", delegateAddress);\n    //   console.log(\"Component delegate Token: \" , res)\n    //   console.log(\"TX Hash: \" ,  res.result)\n    // })\n  }\n  // createWallet(){\n  //   this.userWallet = ethers.Wallet.createRandom().connect(this.provider);\n  //   this.userWallet.getBalance().then(bal=>{\n  //     this.userEthBalance = parseFloat(ethers.utils.formatEther(bal));\n  //   })\n  // }\n  handleAuth() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      console.log(\"HANDLE AUTH***\");\n      window.ethereum.enable();\n      _this.provider.send(\"eth_requestAccounts\", []);\n      console.log(\"CONNECTED!\");\n      console.log(\"provider: \", _this.provider);\n      const signer = yield _this.provider.getSigner();\n      _this.userAddress = yield signer.getAddress();\n      _this.userWallet = signer;\n      _this.userWallet.getBalance().then(bal => {\n        _this.userEthBalance = parseFloat(ethers.utils.formatEther(bal));\n      });\n      _this.tokenContract = new Contract(_this.tokenContractAddress ?? \"\", tokenJson.abi, _this.provider);\n      _this.tokenContract['balanceOf'](_this.userAddress).then(resp => {\n        const balanceStr = ethers.utils.formatEther(resp);\n        _this.userTokenBalance = parseFloat(balanceStr);\n      });\n      //const test = signer.connect(this.provider)\n      //console.log(\"Account:\", await signer.getAddress());\n    })();\n  }\n\n  clearBlock() {\n    this.blockNumber = 1;\n  }\n}\nAppComponent.ɵfac = function AppComponent_Factory(t) {\n  return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n};\nAppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: AppComponent,\n  selectors: [[\"app-root\"]],\n  decls: 10,\n  vars: 1,\n  consts: [[1, \"px-4\", \"py-5\", \"my-5\", \"text-center\"], [1, \"display-5\", \"fw-bold\"], [1, \"col-lg-6\", \"mx-auto\"], [\"class\", \"mt-4\", 4, \"ngIf\"], [1, \"d-grid\", \"gap-2\", \"d-sm-flex\", \"justify-content-sm-center\", \"mt-4\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", \"btn-lg\", \"px-4\", \"gap-3\", 3, \"click\"], [\"type\", \"button\", 1, \"btn\", \"btn-outline-secondary\", \"btn-lg\", \"px-4\", 3, \"click\"], [1, \"mt-4\"], [1, \"lead\", \"mb-4\", \"my-4\"], [\"type\", \"button\", 1, \"btn\", \"btn-success\", \"btn-lg\", \"px-4\", \"gap-3\", \"my-4\", 3, \"click\"], [\"class\", \"card mt-4 mx-auto\", 4, \"ngIf\"], [1, \"card\", \"mt-4\", \"mx-auto\"], [1, \"card-body\"], [1, \"card-title\"], [1, \"card-subtitle\", \"mb-2\", \"text-muted\"], [1, \"card-text\"], [\"type\", \"button\", \"class\", \"btn btn-danger btn-lg px-4 gap-3 my-4\", 3, \"click\", 4, \"ngIf\"], [\"type\", \"number\", \"min\", \"0\", \"max\", \"100\", 1, \"input\"], [\"mintAmount\", \"\"], [\"type\", \"button\", \"class\", \"btn btn-success btn-lg px-4 gap-3 my-4\", 3, \"click\", 4, \"ngIf\"], [\"delegateAmount\", \"\"], [\"type\", \"text\", 1, \"input\"], [\"delegateAddress\", \"\"], [\"type\", \"button\", 1, \"btn\", \"btn-danger\", \"btn-lg\", \"px-4\", \"gap-3\", \"my-4\", 3, \"click\"]],\n  template: function AppComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"h1\", 1);\n      i0.ɵɵtext(2, \"Token Ballot Dapp\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(3, \"div\", 2);\n      i0.ɵɵtemplate(4, AppComponent_div_4_Template, 7, 3, \"div\", 3);\n      i0.ɵɵelementStart(5, \"div\", 4)(6, \"button\", 5);\n      i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_6_listener() {\n        return ctx.syncBlock();\n      });\n      i0.ɵɵtext(7, \"Sync\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(8, \"button\", 6);\n      i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_8_listener() {\n        return ctx.clearBlock();\n      });\n      i0.ɵɵtext(9, \"Clear\");\n      i0.ɵɵelementEnd()()()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngIf\", ctx.blockNumber && ctx.blockNumber > 0);\n    }\n  },\n  dependencies: [i2.NgIf],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["Contract","ethers","tokenJson","i0","API_URL","AppComponent","constructor","http","provider","providers","Web3Provider","window","ethereum","getTokenAddress","get","getTotalSupply","syncBlock","getBlock","then","block","blockNumber","number","transactions","subscribe","resp","tokenContractAddress","address","updateTokenInfo","tokenContract","abi","balanceStr","utils","formatEther","tokenSupply","parseFloat","requestTokens","amount","console","log","url","body","userAddress","parseEther","post","res","result","delegateTokens","delegateAddress","handleAuth","enable","send","signer","getSigner","getAddress","userWallet","getBalance","bal","userEthBalance","userTokenBalance","clearBlock","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["/Users/austinramos/Documents/Workspace/Encode_Bootcamp/14_15_code/frontend/app/src/app/app.component.ts","/Users/austinramos/Documents/Workspace/Encode_Bootcamp/14_15_code/frontend/app/src/app/app.component.html"],"sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { Component } from '@angular/core';\r\nimport {BigNumber, Contract, ethers, Wallet} from 'ethers';\r\n//import * as tokenJson from './assets/MyToken.json';\r\nimport tokenJson from '../assets/MyToken.json';\r\n\r\ndeclare let window: any\r\n\r\nconst API_URL = \"http://localhost:3000\";\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: './app.component.html',\r\n  styleUrls: ['./app.component.scss']\r\n})\r\nexport class AppComponent {\r\n  provider:  ethers.providers.Web3Provider;\r\n  blockNumber: number = 0;\r\n  transactions: string[] | undefined;\r\n  userWallet: ethers.Signer | undefined ;\r\n  userEthBalance: number | undefined;\r\n  userAddress: string | undefined;\r\n  userTokenBalance: number | undefined;\r\n  tokenContractAddress: string | undefined;\r\n  tokenSupply: number | undefined;\r\n  tokenContract: Contract | undefined ;\r\n\r\n  constructor( private http: HttpClient ){\r\n     //this.provider = ethers.getDefaultProvider('goerli');\r\n     this.provider = new ethers.providers.Web3Provider(window.ethereum);\r\n     \r\n     //setInterval(()=>{this.blockNumber +=1 })\r\n    }\r\n\r\n    getTokenAddress(){\r\n      return this.http.get<{address: string}>(API_URL + \"/contract-address\");\r\n    }\r\n\r\n    getTotalSupply(){\r\n      return this.http.get<{supply: number}>(API_URL + \"/total-supply\");\r\n    }\r\n\r\n    syncBlock(){\r\n      //this.blockNumber = \"loading...\";\r\n    this.provider.getBlock(\"latest\").then(block=>{\r\n      this.blockNumber = block.number;\r\n      this.transactions = block.transactions;\r\n      \r\n    });\r\n    this.getTokenAddress().subscribe(resp=>{\r\n      this.tokenContractAddress = resp.address;\r\n      this.updateTokenInfo()\r\n    })\r\n   \r\n    }\r\n\r\n    updateTokenInfo(){\r\n        this.tokenContract = new Contract(this.tokenContractAddress ?? \"\",tokenJson.abi,this.provider)\r\n\r\n        this.tokenContract['totalSupply']().then((resp: ethers.BigNumber)=>{\r\n          const balanceStr = ethers.utils.formatEther(resp)\r\n          this.tokenSupply=parseFloat(balanceStr)\r\n        })\r\n    \r\n      }\r\n\r\n      requestTokens(amount: string ){\r\n        console.log(\"component requestToken amount: \" , amount)\r\n        const url = API_URL + \"/request-tokens\";\r\n        const body = {address:this.userAddress,amount: ethers.utils.parseEther(amount)};\r\n        return this.http.post<{result: string}>(url, body).subscribe((res)=>{\r\n          console.log(\"requested amount \" , amount , \" tokens for address \" , this.userAddress)\r\n          console.log(\"component Request Token: \" , res)\r\n          console.log(\"TX Hash: \" ,  res.result)\r\n        })\r\n\r\n        \r\n      }\r\n\r\n      delegateTokens(amount: string, delegateAddress: string){\r\n        console.log(\"component delegateToken amount: \" , amount)\r\n        this.tokenContract = new Contract(this.tokenContractAddress ?? \"\",tokenJson.abi,this.provider)\r\n        this.tokenContract['delegate'](ethers.utils.parseEther(amount),delegateAddress).then((resp: ethers.BigNumber)=>{\r\n          const balanceStr = ethers.utils.formatEther(resp)\r\n          this.tokenSupply=parseFloat(balanceStr)\r\n        })\r\n        // const url = API_URL + \"/delegate-tokens\";\r\n        // const body = {address:this.userAddress,delegate:delegateAddress,amount: ethers.utils.parseEther(amount)};\r\n        // return this.http.post<{result: string}>(url, body).subscribe((res)=>{\r\n        //   console.log(\"Delegated \" , amount , \" tokens from address \" , this.userAddress, \"to address \", delegateAddress);\r\n        //   console.log(\"Component delegate Token: \" , res)\r\n        //   console.log(\"TX Hash: \" ,  res.result)\r\n        // })\r\n      }\r\n\r\n    // createWallet(){\r\n    //   this.userWallet = ethers.Wallet.createRandom().connect(this.provider);\r\n    //   this.userWallet.getBalance().then(bal=>{\r\n    //     this.userEthBalance = parseFloat(ethers.utils.formatEther(bal));\r\n    //   })\r\n    // }\r\n\r\n    async handleAuth() {\r\n      console.log(\"HANDLE AUTH***\")\r\n      window.ethereum.enable()\r\n      this.provider.send(\"eth_requestAccounts\", [])\r\n      console.log(\"CONNECTED!\")\r\n      console.log(\"provider: \" , this.provider);\r\n      const signer = await this.provider.getSigner();\r\n      this.userAddress = await signer.getAddress();\r\n      this.userWallet=signer\r\n\r\n        this.userWallet.getBalance().then(bal=>{\r\n        this.userEthBalance = parseFloat(ethers.utils.formatEther(bal));\r\n      })\r\n\r\n\r\n      \r\n\r\n      this.tokenContract = new Contract(this.tokenContractAddress ?? \"\",tokenJson.abi,this.provider)\r\n\r\n      this.tokenContract['balanceOf'](this.userAddress).then((resp: ethers.BigNumber)=>{\r\n        const balanceStr = ethers.utils.formatEther(resp)\r\n        this.userTokenBalance=parseFloat(balanceStr)\r\n      })\r\n      \r\n      \r\n      \r\n      //const test = signer.connect(this.provider)\r\n      //console.log(\"Account:\", await signer.getAddress());\r\n\r\n    }\r\n\r\n    clearBlock(){\r\n      this.blockNumber = 1;\r\n    \r\n    }\r\n}\r\n\r\n","<!-- <p> My name is {{myName}}</p>\r\n\r\n<p>Block number is {{blockNumber}}</p>\r\n\r\n<div class=\"container  text-center mt-5 mb-5\">\r\n  <h1>Bootstrap 5 is working fine with Angular 15!!</h1>\r\n</div> -->\r\n<div class=\"px-4 py-5 my-5 text-center\">\r\n  <h1 class=\"display-5 fw-bold\">Token Ballot Dapp</h1>\r\n  <div class=\"col-lg-6 mx-auto\">\r\n      <div *ngIf=\"blockNumber && blockNumber>0\" class = \"mt-4\" >\r\n    <p class=\"lead mb-4 my-4\">\r\n      We are connected to Goerli at\r\n       Block number {{blockNumber}}. \r\n       </p>\r\n    <button type=\"button\" class=\"btn btn-success btn-lg px-4 gap-3 my-4\" (click) = \"handleAuth()\" >\r\n      Connect Wallet\r\n    </button>\r\n    <!-- <button type=\"button\" class=\"btn btn-success btn-lg px-4 gap-3 my-4\" (click) = \"createWallet()\" >\r\n      {{userWallet ? \"Recreate\" : \"Create\"}} Wallet\r\n    </button> -->\r\n    \r\n\r\n      <div *ngIf=\"userWallet\" class=\"card mt-4 mx-auto\" >\r\n        <div class=\"card-body\">\r\n          <h5 class=\"card-title\">User Wallet</h5>\r\n          <h6 class=\"card-subtitle mb-2 text-muted\">{{userAddress}}</h6>\r\n          <p class=\"card-text\"> Balance: {{userEthBalance}} Eth</p>\r\n          <p class=\"card-text\"> Token Balance: {{userTokenBalance}} MKT</p>\r\n           \r\n          <button *ngIf =\"mintAmount\" \r\n            type=\"button\" \r\n            class=\"btn btn-danger btn-lg px-4 gap-3 my-4\" \r\n            (click) = \"requestTokens(mintAmount.value)\" >\r\n            Request Voting Tokens\r\n          </button>\r\n          <p>Amount: </p>\r\n          <input #mintAmount type=\"number\" min=\"0\" max = \"100\" class=\"input\">\r\n\r\n          <button *ngIf =\"delegateAmount\" \r\n          type=\"button\" \r\n          class=\"btn btn-success btn-lg px-4 gap-3 my-4\" \r\n          (click) = \"delegateTokens(delegateAmount.value, delegateAddress.value)\" >\r\n          Delegate Voting Tokens\r\n        </button>\r\n        <p>Amount: </p>\r\n        <input #delegateAmount type=\"number\" min=\"0\" max = \"100\" class=\"input\">\r\n        <p>Address: </p>\r\n        <input #delegateAddress type=\"text\" class=\"input\">\r\n \r\n        </div>\r\n      </div>\r\n      <div *ngIf=\"tokenContractAddress\" class=\"card mt-4 mx-auto\" >\r\n        <div class=\"card-body\">\r\n          <h5 class=\"card-title\">TokenContract</h5>\r\n          <h6 class=\"card-subtitle mb-2 text-muted\">{{tokenContractAddress}}</h6>\r\n          <p class=\"card-text\"> Total token Supply: {{tokenSupply}} MKT Tokens</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  \r\n    <div class=\"d-grid gap-2 d-sm-flex justify-content-sm-center mt-4\">\r\n      <button type=\"button\" class=\"btn btn-primary btn-lg px-4 gap-3\" (click) = \"syncBlock()\" >Sync</button>\r\n      <button type=\"button\" class=\"btn btn-outline-secondary btn-lg px-4\" (click) = \"clearBlock()\" >Clear</button>\r\n    </div>\r\n  </div>\r\n</div>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}